<lms>
    <service name="PHOENIX_SERVICE" lib="phoenix_CC2016_service" class="Phoenix_CC2016Service">
        <name>PHOENIX_SERVICE</name>
        <realName>phoenix_CC2016_service</realName>
            <config>
                <stateFromConfig>true</stateFromConfig>
                <updateInMilliS>-1</updateInMilliS>
            </config>
    </service>
    <service name="LOCAL_COURSE_SERVICE" lib="local_course" class="LocalCourse">
        <config>
            <useFast>true</useFast>
            <elementCount>6</elementCount>
            <elementLength>0.30</elementLength>
            <combinePointMaxDistance>0.02</combinePointMaxDistance>
            <adamA>0.008</adamA>
            <adamB1>0.9</adamB1>
            <adamB2>0.997</adamB2>
            <adamIterations>2</adamIterations><!--Damit kann man beliebig viel Rechenzeit belegen :)-->
        </config>
    </service>
    <module name="lap_time" lib="lap_time" class="LapTime">
        <channelMapping from="ENVIRONMENT" to="ENVIRONMENT_OBSTACLE"/>
    </module>
    <module name="pause_runtime" lib="pause_runtime" class="PauseRuntime">
    </module>
    <module name="obstacle_from_laser" lib="obstacle_from_laser" class="ObstacleFromLaser">
        <channelMapping from="POINTS" to="URG_DATA"/>
    </module>
    <module name="trajectory_point_controller" lib="trajectory_point_controller" class="TrajectoryPointController">
        <channelMapping from="TRAJECTORY" to="TRAJECTORY_LINE"/>
        <config>
            <!--MPC-controller-->
            <mpcLookupVelocityX>1.0, 2.5, 6.0</mpcLookupVelocityX>
            <mpcLookupVelocityY>1.0, 2.5, 5.0</mpcLookupVelocityY>
            <regelpunktMin>0.4</regelpunktMin>
            <regelpunktSlope>0.1</regelpunktSlope>
            <distanceRegelpunkt>0.9</distanceRegelpunkt>
            <yawRateBoost>0.0</yawRateBoost>
            <useMPCcontroller>true</useMPCcontroller>
            <weight_y>20</weight_y>
            <weight_phi>5</weight_phi>
            <weight_steering_front>0.0001</weight_steering_front>
            <weight_steering_rear>8</weight_steering_rear>
            <maxParallelAusweichen>0.2</maxParallelAusweichen>
            <!--velocity-controller -->
            <!-- trajecotryPoint-->
            <trajectoryPointDistanceLookupX>1.8,3.0</trajectoryPointDistanceLookupX>
            <trajectoryPointDistanceLookupY>0.6,0.6</trajectoryPointDistanceLookupY>

            <!--default velo-->
            <forcastLength>1</forcastLength>
            <minForcastLength>0.4</minForcastLength>
            <maxForcastLength>1.4</maxForcastLength>
            <targetForcastLength>1.0</targetForcastLength>
            <weightSlope>2</weightSlope>
            <weightOffset>3</weightOffset>
            <!-- pid controller -->
            <PID_front_Kp>1</PID_front_Kp>
            <PID_front_Ki>1</PID_front_Ki>
            <PID_front_Kd>1</PID_front_Kd>

            <PID_rear_Kp>1</PID_rear_Kp>
            <PID_rear_Ki>1</PID_rear_Ki>
            <PID_rear_Kd>1</PID_rear_Kd>

            <!--stop at crossing -->
            <!-- stop on crossing-->
            <PID_Kp>2</PID_Kp>
            <PID_Ki>0</PID_Ki>
            <PID_Kd>0</PID_Kd>
            <crossingSaftyZone>0.05</crossingSaftyZone>
            <maxVelocityCrossing>2.0</maxVelocityCrossing>
            <distanceToStop>2.0</distanceToStop>
            <stoppingDistance>0.35</stoppingDistance>

        </config>
    </module>
    <module name="trajectory_creator" lib="trajectory_creator" class="TrajectoryLineCreator">
        <channelMapping from="LINE" to="TRAJECTORY_LINE"/>
        <channelMapping from="ROAD" to="MIDDLE_LANE"/>
        <channelMapping from="ENVIRONMENT_OBSTACLE" to="ENVIRONMENT_OBSTACLE"/>
        <channelMapping priority="9" from="CAR" to="CAR"/>
        <config name="FMH">
            <velocity_straight>4.5</velocity_straight>
            <curve_maxVelocity>3.5</curve_maxVelocity>
            <curve_minVelocity>2.0</curve_minVelocity>
            <curveStraight_maxVelocity>3.0</curveStraight_maxVelocity>
            <curveStraight_minVelocity>2.0</curveStraight_minVelocity>
            <aOrthMax>2.5</aOrthMax>
            <simpleTraj>true</simpleTraj>
            <angleD>0.35</angleD>
            <obstacleResolution>0.05</obstacleResolution>
            <minDistanceBetweenTrajectoryPoints>0.2</minDistanceBetweenTrajectoryPoints>
            <distanceObstacleBeforeChangeLine>1</distanceObstacleBeforeChangeLine>
            <obstacleLength>0.7</obstacleLength>
        </config>
        <config name="FOH">
            <velocity_straight>5.0</velocity_straight>
            <curve_maxVelocity>2.8</curve_maxVelocity>
            <curve_minVelocity>2.4</curve_minVelocity>
            <curveStraight_maxVelocity>4.0</curveStraight_maxVelocity>
            <curveStraight_minVelocity>2.8</curveStraight_minVelocity>
            <aOrthMax>3.5</aOrthMax>
            <simpleTraj>true</simpleTraj>
            <angleD>0.35</angleD>
            <obstacleResolution>0.05</obstacleResolution>
            <minDistanceBetweenTrajectoryPoints>0.2</minDistanceBetweenTrajectoryPoints>
            <distanceObstacleBeforeChangeLine>1</distanceObstacleBeforeChangeLine>
            <obstacleLength>0.7</obstacleLength>
        </config>
        <config>
          <obstacleResolution>0.05</obstacleResolution>
          <minDistanceBetweenTrajectoryPoints>0.2</minDistanceBetweenTrajectoryPoints>
          <obstacleSavetyDistance>1.0</obstacleSavetyDistance>
          <simpleTraj>true</simpleTraj>
        </config>
        <config src="street_utils/obstacle.lconf"/>
        <config src="trajectory_creator.lconf"/>
    </module>
    <module name="course_state_estimator" lib="course_state_estimator" class="CourseStateEstimator">
        <name>course_state_estimator</name>
        <channelMapping from="ROAD" to="MIDDLE_LANE"/>
        <channelMapping from="ENVIRONMENT" to="ENVIRONMENT_ROAD_RAW"/>
        <config>
        <observationProbability1>0.6</observationProbability1>
            <observationProbability2>0.7</observationProbability2>
            <distance1>0.4</distance1>
            <distance2>0.8</distance2>
            <distance3>0.8</distance3>
            <distance4>1.4</distance4>
            <curvatureThreshold>0.2</curvatureThreshold>
            <transitionProbabilityStraightToStraightCurve>0.002</transitionProbabilityStraightToStraightCurve>
            <transitionProbabilityStraightCurveToCurve>0.002</transitionProbabilityStraightCurveToCurve>
            <transitionProbabilityCurveToStraight>0.001</transitionProbabilityCurveToStraight>
            <useKalmanCurvature>true</useKalmanCurvature>
            <useProbabilitiesStraight>true</useProbabilitiesStraight>
         </config>
    </module>
    <if set="sendData">
        <module name="image_converter_scaledown" lib="image_converter" class="ImageConverter">
            <channelMapping from="INPUT_IMAGE" to="GREY_IMAGE"/>
            <channelMapping from="OUTPUT_IMAGE" to="IMAGE_GREY_SCALE"/>
            <config>
                <scaleDown>4</scaleDown>
            </config>
        </module>
        <module name="socket_data_sender" lib="socket_data_sender" class="Sender">
            <config>
                <ip>localhost</ip>
                <port>65001</port>
            </config>
        </module>
    </if>
    <module name="street_obstacle_merger" lib="street_obstacle_merger" class="StreetObjectMaster">
        <name>street_obstacle_merger</name>
        <channelMapping priority="10" from="CAR" to="CAR"/>
        <channelMapping from="ENVIRONMENT_OUTPUT" to="ENVIRONMENT_MASTER"/>
        <config src="street_utils/obstacle.lconf"/>
        <config>
            <environments>ENVIRONMENT</environments>
        </config>
    </module>
    <include src="ego.xml"/>
    <!--include src="imaging_old.xml"/-->
    <include src="imaging_new.xml"/>
</lms>
